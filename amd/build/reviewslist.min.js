define(["jquery","core/ajax","core/templates","core/notification",],function(a,e,t,i){return{reviews:function(){a(document).on("click",".page-link",function(t){t.preventDefault();var o=a(this).attr("href"),l=r("page",o),c=a(".activity-search").val(),s=a("#coursesearch_id").find(":selected").val();"Course"===s&&(s="");var d=n(),u=d.column,p=d.order;if(!l)return!1;var m={pix:M.util.image_url("i/loading","core"),component:"moodle"},g=a('<img style="display: block;margin: 100px auto" />').attr("src",M.util.image_url(m.pix,m.component)).addClass("spinner");a(".sorted_data").html('<tr> <td colspan="8">'+g.get(0).outerHTML+"</td></tr>"),e.call([{methodname:"block_pi_reviews_get_reviews",args:{cid:s,search:c,column:u,page:l,duesorting:p}},])[0].done(function(e){a(".sorted_data").html(e.displayhtml),a(".pagination-nav-filter").html(e.pagedata)}).fail(i.exception)}),a(document).on("keyup",".activity-search",o(function(t){t.preventDefault();var o=r("page",window.location.href),l=a(".activity-search").val(),c=a("#coursesearch_id").find(":selected").val();"Course"===c&&(c="");var s=n(),d=s.column,u=s.order,p={pix:M.util.image_url("i/loading","core"),component:"moodle"},m=a('<img style="display: block;margin: 100px auto" />').attr("src",M.util.image_url(p.pix,p.component)).addClass("spinner");a(".sorted_data").html('<tr> <td colspan="8">'+m.get(0).outerHTML+"</td></tr>"),e.call([{methodname:"block_pi_reviews_get_reviews",args:{cid:c,search:l,column:d,page:o,duesorting:u}},])[0].done(function(e){a(".sorted_data").html(e.displayhtml),a(".pagination-nav-filter").html(e.pagedata)}).fail(i.exception)},1e3)),a(document).on("click","th",o(function(t){t.preventDefault();var n="asc",o=a(this).data("column");n=a(this).hasClass("asc")?"desc":"asc",a(".table").find("th").removeClass("asc desc"),a(this).addClass(n);var l=window.location.href,c=a("#coursesearch_id").find(":selected").val(),s=a(".activity-search").val(),d=n;"Course"===c&&(c=""),r("page",l);var u={pix:M.util.image_url("i/loading","core"),component:"moodle"},p=a('<img style="display: block;margin: 100px auto" />').attr("src",M.util.image_url(u.pix,u.component)).addClass("spinner");a(".sorted_data").html('<tr> <td colspan="8">'+p.get(0).outerHTML+"</td></tr>"),e.call([{methodname:"block_pi_reviews_get_reviews",args:{cid:c,search:s,page:0,column:o,duesorting:d}},])[0].done(function(e){a(".sorted_data").html(e.displayhtml),a(".pagination-nav-filter").html(e.pagedata)}).fail(i.exception)},1e3))}};function r(a,e){return decodeURIComponent((RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(e)||[null,""])[1].replace(/\+/g,"%20"))||null}function n(){var e="",t="";return a(".assignment-approval-table thead th.sortable").each(function(){var i=a(this).attr("class"),r=a(this).data("column");if("sortable asc"===i||"sortable desc"===i){var n=i.split(" ",2);e=r,t=n[1]}}),{column:e,order:t}}function o(a,e){var t=0;return function(){var i=this,r=arguments;clearTimeout(t),t=setTimeout(function(){a.apply(i,r)},e||0)}}});