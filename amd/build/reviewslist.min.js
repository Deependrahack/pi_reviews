define(["jquery","core/ajax","core/templates","core/notification",],function(a,t,e,r){return{reviews:function(){a(document).on("click",".page-link",function(e){e.preventDefault();var l=a(this).attr("href"),n=i("page",l),c=a(".activity-search").val(),s=a("#coursesearch_id").find(":selected").val();"Course"===s&&(s="");var d="";""!==c.trim()&&(d="&search="+c);var u="";""!==s.trim()&&(u="&cid="+s);var p=a("#download").attr("acturalurl");p=p+d+u,a("#download").attr("href",p);var m=o(),h=m.column,g=m.order;if(!n)return!1;var v={pix:M.util.image_url("i/loading","core"),component:"moodle"},f=a('<img style="display: block;margin: 100px auto" />').attr("src",M.util.image_url(v.pix,v.component)).addClass("spinner");a(".sorted_data").html('<tr> <td colspan="8">'+f.get(0).outerHTML+"</td></tr>"),t.call([{methodname:"block_pi_reviews_get_reviews",args:{cid:s,search:c,column:h,page:n,duesorting:g}},])[0].done(function(t){a(".sorted_data").html(t.displayhtml),a(".pagination-nav-filter").html(t.pagedata)}).fail(r.exception)}),a(document).on("keyup",".activity-search",l(function(e){e.preventDefault();var l=i("page",window.location.href),n=a(".activity-search").val(),c=a("#coursesearch_id").find(":selected").val();"Course"===c&&(c="");var s="";""!==n.trim()&&(s="&search="+n);var d="";""!==c.trim()&&(d="&cid="+c);var u=a("#download").attr("acturalurl");u=u+s+d,a("#download").attr("href",u);var p=o(),m=p.column,h=p.order,g={pix:M.util.image_url("i/loading","core"),component:"moodle"},v=a('<img style="display: block;margin: 100px auto" />').attr("src",M.util.image_url(g.pix,g.component)).addClass("spinner");a(".sorted_data").html('<tr> <td colspan="8">'+v.get(0).outerHTML+"</td></tr>"),t.call([{methodname:"block_pi_reviews_get_reviews",args:{cid:c,search:n,column:m,page:l,duesorting:h}},])[0].done(function(t){a(".sorted_data").html(t.displayhtml),a(".pagination-nav-filter").html(t.pagedata)}).fail(r.exception)},1e3)),a(document).on("change",".coursesearch",l(function(e){e.preventDefault();var l=i("page",window.location.href),n=a(".activity-search").val(),c=a("#coursesearch_id").find(":selected").val();"Course"===c&&(c="");var s="";""!==n.trim()&&(s="&search="+n);var d="";""!==c.trim()&&(d="&cid="+c);var u=a("#download").attr("acturalurl");u=u+s+d,a("#download").attr("href",u);var p=o(),m=p.column,h=p.order,g={pix:M.util.image_url("i/loading","core"),component:"moodle"},v=a('<img style="display: block;margin: 100px auto" />').attr("src",M.util.image_url(g.pix,g.component)).addClass("spinner");a(".sorted_data").html('<tr> <td colspan="8">'+v.get(0).outerHTML+"</td></tr>"),t.call([{methodname:"block_pi_reviews_get_reviews",args:{cid:c,search:n,column:m,page:l,duesorting:h}},])[0].done(function(t){a(".sorted_data").html(t.displayhtml),a(".pagination-nav-filter").html(t.pagedata)}).fail(r.exception)},1e3)),a(document).on("click","th",l(function(e){e.preventDefault();var o="asc",l=a(this).data("column");o=a(this).hasClass("asc")?"desc":"asc",a(".table").find("th").removeClass("asc desc"),a(this).addClass(o);var n=window.location.href,c=a("#coursesearch_id").find(":selected").val(),s=a(".activity-search").val(),d=o;"Course"===c&&(c=""),i("page",n);var u={pix:M.util.image_url("i/loading","core"),component:"moodle"},p=a('<img style="display: block;margin: 100px auto" />').attr("src",M.util.image_url(u.pix,u.component)).addClass("spinner");a(".sorted_data").html('<tr> <td colspan="8">'+p.get(0).outerHTML+"</td></tr>"),t.call([{methodname:"block_pi_reviews_get_reviews",args:{cid:c,search:s,page:0,column:l,duesorting:d}},])[0].done(function(t){a(".sorted_data").html(t.displayhtml),a(".pagination-nav-filter").html(t.pagedata)}).fail(r.exception)},1e3))}};function i(a,t){return decodeURIComponent((RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(t)||[null,""])[1].replace(/\+/g,"%20"))||null}function o(){var t="",e="";return a(".assignment-approval-table thead th.sortable").each(function(){var r=a(this).attr("class"),i=a(this).data("column");if("sortable asc"===r||"sortable desc"===r){var o=r.split(" ",2);t=i,e=o[1]}}),{column:t,order:e}}function l(a,t){var e=0;return function(){var r=this,i=arguments;clearTimeout(e),e=setTimeout(function(){a.apply(r,i)},t||0)}}});
